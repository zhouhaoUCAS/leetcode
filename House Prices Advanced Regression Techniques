# -*- coding: utf-8 -*-
"""
Created on Tue Apr 24 14:51:21 2018

@author: zh
"""
#load numerical packages
import pandas as pd
import numpy as np

import matplotlib.pyplot as plt
import seaborn as sns 

#import data
train=pd.read_csv(r'C:\Users\zh\Downloads\House Prices Advanced Regression Techniques/train.csv')
test=pd.read_csv(r'C:\Users\zh\Downloads\House Prices Advanced Regression Techniques/test.csv')
print('训练集维数：',train.shape)
print('测试集维数：',test.shape)
alldata=pd.concat((train.iloc[:,1:80],test.iloc[:,1:80]),ignore_index=True)
print('可操作的数据维度：',alldata.shape)

#1.1 view data 统计量 statistic
view=train.describe(include='all').T#查看所有数据，特征较多故倒置
view['null']=len(train)-view['count']#增加一行各特征缺失值个数
view.insert(0,'dytype',train.dtypes)#插入一行各特征取值类型,dataframe.insert(索引，列名，series等)
view.T.to_csv('view1.csv')#再转置写入CSV文件

view=alldata.describe(include='all').T
view['null']=len(alldata)-view['count']
view.insert(0,'dytype',alldata.dtypes)
view.T.to_csv('view2.csv')

#1.2  相关性分析 correlation analysis
corrmat=train.corr()#创造一个画布和一组子图，相关系数矩阵
f,ax=plt.subplots(figsize=(12,9))#figsize 每英寸高度和宽度，plt.subplots(a,b)生成a行b列子图默认为1，返回二值型元祖，第一个元素为画布，第二为子图a[1][1]第二行第二列
sns.heatmap(train.corr(),ax=ax,vmax=1.0,vmin=0)#sns.heatmap(data,ax=ax[1](指定子图)，vmax,vmin根据data取值)
plt.title('Correlation of features')#plt.title(str)增加标题
ax.set_xlabel('Feature')#ax.set_x(y)label(str)设置xy轴名字  plot()函数是个2D曲线绘图函数
ax.set_ylabel('Feature')#plt.xlabel(str) plt.ylabel(str)

#1.3查看影响价格最重要的几个特征
k=10 #可查看K个和价格相关性最强的变量
plt.figure(figsize=(12,9))#创造一个画布
cols=corrmat.nlargest(k,'SalePrice').index#dataframe.nlargest(k,标签）返回前K个最大的行，nsmallest相反
cm=np.corrcoef(train[cols].values.T)#np.corrcoef 返回协方差矩阵,pd.values按行提取所以转置
sns.set(font_scale=1.5)#设置标签字体大小
hm=sns.heatmap(cm, cbar=True, annot=True, square=True, fmt='.2f', annot_kws={'size': 10}, yticklabels=cols.values, xticklabels=cols.values)
#annot=True显示热力图上数值大小，square=True将图变成正方形默认矩形，fmt字符，xticklabels: 如果是True，则绘制dataframe的列名。如果是False，则不绘制列名。如果是列表，则绘制列表中的内容作为xticklabels。 如果是整数n，则绘制列名，但每个n绘制一个label。 默认为True
#annot_kws，当annot为True时，可设置各个参数，包括大小，颜色，加粗，斜体字等。cbar:是否在热力图侧边绘制颜色刻度条，默认值是True
plt.savefig('相关性强.jpg')#储存图片
plt.show()


corr=train.corr()
corr[corr['SalePrice']>0.5]

#绘制散点矩阵图
sns.set()
cols = ['SalePrice', 'OverallQual', 'GrLivArea', 'GarageCars', 'TotalBsmtSF', 'FullBath', 'YearBuilt']
sns.pairplot(train[cols], size = 2.5)#sns.pairplot(data)绘制散点图矩阵，多变量数据不能有空值，不然会出错
plt.show()

#查看价格分布
train['SalePrice'].describe()

#画直方图
from scipy import stats  #引入统计包
from scipy.stats import norm #引入正态函数
sns.distplot(train['SalePrice'],fit=norm)#sns.distplot画直线图，fit拟合函数
fig=plt.figure()
stats.probplot(train['SalePrice'],plot=plt)#理论分布的分位数（默认情况下的正态分布）生成样本数据的概率图。 probplot可选地计算数据的最佳拟合线，并使用Matplotlib或给定的绘图函数绘制结果
#plot=plt表示绘图matplotlib.pyplot模块 ，无不创建绘图





